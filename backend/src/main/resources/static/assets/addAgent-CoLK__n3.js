import{a as v}from"./config-CkEC2-gR.js";import"./authGuard-IHeZeQgb.js";function d(e,t="info"){const n={success:"bg-green-500",error:"bg-red-500",info:"bg-blue-500"},r=document.createElement("div");r.className=`${n[t]} text-white px-4 py-2 rounded-lg shadow-lg fixed top-4 right-4 z-50 animate-bounce`,r.textContent=e,document.body.appendChild(r),setTimeout(()=>{r.remove()},4e3)}const c=document.getElementById("agentNom"),l=document.getElementById("agentPrenom"),a=document.getElementById("agentMatricule"),u=document.getElementById("agentFonction"),s=document.getElementById("addAgentBtn"),f=document.getElementById("cancelBtn"),o=document.getElementById("agentCentre");let p=!1;function h(){c&&(c.value=""),l&&(l.value=""),a&&(a.value=""),u&&(u.value=""),o&&(o.value="")}function E(e){d(`${e}`,"error")}function y(e){d(`${e}`,"success")}function C(){const e=c?.value.trim(),t=l?.value.trim(),n=a?.value.trim(),r=u?.value.trim(),m=o?.value.trim();return!e||!t||!n||!r||!m?(d("Veuillez remplir tous les champs obligatoires","info"),!1):n.length<3?(d("Le matricule doit contenir au moins 3 caractères","info"),a?.focus(),!1):!0}async function g(){if(p||!C())return;const e={matricule:a.value.trim().toUpperCase(),nom:c.value.trim(),prenom:l.value.trim(),fonction:u.value.trim(),code:parseInt(o.value.trim(),10)};try{p=!0,s.disabled=!0,s.textContent="Ajout en cours...";const t=await fetch(`${v}/agent`,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let i="Erreur lors de l'ajout de l'agent";try{i=(await t.json()).message||i}catch{t.status===415?i="Format de données non supporté":t.status===400?i="Données invalides":t.status===409?i="Le matricule existe déjà":i=`Erreur ${t.status}: ${t.statusText}`}throw new Error(i)}const n=await t.json(),r=o.options[o.selectedIndex],m=r?r.textContent:"";y(`Agent enregistré avec succès !
Matricule: ${n.matricule}
Nom: ${n.prenom} ${n.nom}
Centre: ${m}`),h()}catch(t){console.error("Erreur lors de l'ajout de l'agent:",t),E(t.message||"Erreur de connexion au serveur")}finally{p=!1,s.disabled=!1,s.textContent="Ajouter"}}async function b(){try{const e=await fetch(`${v}/centre`,{method:"GET",headers:{Accept:"application/json"}});if(!e.ok)throw new Error(`Erreur lors du chargement des centres (${e.status})`);const t=await e.json();if(!Array.isArray(t))throw new Error("Format de réponse invalide pour les centres");o&&(o.innerHTML='<option value="">Sélectionnez un centre</option>',t.forEach(n=>{const r=document.createElement("option");r.value=n.code,r.textContent=n.libelleCentre,o.appendChild(r)}))}catch(e){console.error("Erreur chargement centres:",e),E("Impossible de charger la liste des centres"),o&&(o.innerHTML='<option value="">Erreur de chargement des centres</option>')}}document.addEventListener("DOMContentLoaded",()=>{if(!window.AuthGuard){console.error("AuthGuard non disponible");const e=window.location.pathname;let t="./login.html";(e==="/"||e.endsWith("index.html"))&&(t="./src/html/login.html"),window.location.replace(t);return}b(),s&&s.addEventListener("click",e=>{e.preventDefault(),g()}),f&&f.addEventListener("click",e=>{e.preventDefault(),h(),y("Formulaire réinitialisé")}),a&&a.addEventListener("input",e=>{e.target.value=e.target.value.toUpperCase(),e.target.value=e.target.value.replace(/[^A-Z0-9]/g,"")}),[c,l].forEach(e=>{e&&e.addEventListener("input",t=>{t.target.value=t.target.value.replace(/[0-9]/g,""),t.target.value=t.target.value.replace(/\b\w/g,n=>n.toUpperCase())})}),[c,l,a,u].forEach(e=>{e&&e.addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),g())})}),o&&o.addEventListener("keypress",e=>{e.key==="Enter"&&(e.preventDefault(),g())})});
