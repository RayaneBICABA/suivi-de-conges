import"./modulepreload-polyfill-B5Qt9EMX.js";const h=document.getElementById("refNumber"),y=document.getElementById("year"),I=document.getElementById("checkBtn"),s=document.getElementById("result"),c=document.getElementById("overlay"),E=document.getElementById("closePopup"),B=document.getElementById("decisionNumber"),a=document.getElementById("nom"),l=document.getElementById("prenom"),o=document.getElementById("matricule"),d=document.getElementById("joursConges"),L=document.getElementById("confirmerBtn"),T=document.getElementById("annulerBtn");let p="",g="",i="";function $(){c.classList.remove("hidden"),c.classList.add("flex"),i=`${p}/DRH/${g}`,B.value=i}function m(){c.classList.add("hidden"),c.classList.remove("flex")}function R(){o.value="",d.value="0",a.value="",l.value=""}async function f(e){if(!e.trim()){a.value="",l.value="";return}try{const t=await fetch(`http://localhost:8080/agent/nomPrenom?matricule=${encodeURIComponent(e)}`);if(t.ok){const n=await t.json();a.value=n.nom||"",l.value=n.prenom||""}else a.value="",l.value=""}catch(t){a.value="",l.value="",console.error(t)}}I.addEventListener("click",async()=>{const e=h.value,t=y.value;if(!e||!t){s.innerHTML=`<span class="text-red-600">Veuillez entrer le numéro et l'année.</span>`;return}p=e,g=t;try{const n=await fetch(`http://localhost:8080/conge/checkRef?refNumber=${e}&year=${t}`),r=await n.text(),u=`${e}/DRH/${t}`;n.ok?(s.innerHTML=`<span class="text-green-600">Référence trouvée : <b>${u}</b></span>`,setTimeout(()=>{window.location.href=`src/html/priseconge.html?congeRef=${encodeURIComponent(u)}`},1e3)):(s.innerHTML=`<span class="text-red-600">${r}</span>`,setTimeout($,500))}catch(n){s.innerHTML=`<span class="text-red-600">Erreur: ${n.message}</span>`}});E.addEventListener("click",m);c.addEventListener("click",e=>{e.target===c&&m()});T.addEventListener("click",()=>{R(),m()});L.addEventListener("click",async()=>{const e=o.value.trim(),t=parseInt(d.value)||0;if(!e)return alert("Veuillez saisir un matricule.");if(t<=0)return alert("Nombre de jours invalide.");const n={reference:i,matriculeAgent:e,jours:t};try{const r=await fetch("http://localhost:8080/conge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),u=await r.json();if(r.ok)m(),s.innerHTML='<span class="text-green-600">Congé créé avec succès ! Redirection...</span>',setTimeout(()=>{window.location.href=`src/html/priseconge.html?congeRef=${encodeURIComponent(i)}`},2e3);else{const v=u.message||"Erreur lors de la création du congé";alert(`❌ ${v}`)}}catch(r){alert(`Erreur de connexion : ${r.message}`)}});o.addEventListener("input",e=>{clearTimeout(o.searchTimeout),o.searchTimeout=setTimeout(()=>{f(e.target.value.trim())},500)});o.addEventListener("blur",()=>f(o.value.trim()));
