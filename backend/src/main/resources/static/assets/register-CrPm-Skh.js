import{a as c}from"./config-CkEC2-gR.js";let a=[];function m(){const s=document.getElementById("direction");s&&(s.innerHTML='<option value="">-- Sélectionnez une direction --</option>',a.forEach(e=>{const t=document.createElement("option");t.value=e.numero,t.textContent=e.nom,s.appendChild(t)}))}async function g(){try{const e=await(await fetch(`${c}/api/direction`)).json();a.length=0,a.push(...e),m()}catch(s){console.error("Erreur lors du chargement des directions:",s),n.showError("Erreur lors du chargement des directions")}}class l{static async register(e){try{const t=await fetch(`${c}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de l'inscription");return{success:!0,data:r}}catch(t){return{success:!1,error:t.message}}}static async login(e){try{const t=await fetch(`${c}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la connexion");return{success:!0,data:r}}catch(t){return{success:!1,error:t.message}}}static storeAuthData(e){localStorage.setItem("authToken",e.token),localStorage.setItem("userData",JSON.stringify(e.user))}static getToken(){return localStorage.getItem("authToken")}static isLoggedIn(){const e=this.getToken();return e!==null&&e!==""}static logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userData")}}class n{static showError(e,t="error-container"){let r=document.getElementById(t);if(!r){r=document.createElement("div"),r.id=t,r.className="mb-4";const o=document.querySelector("form");o.parentNode.insertBefore(r,o)}r.innerHTML=`
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <strong>Erreur:</strong> ${e}
            </div>
        `}static showSuccess(e,t="success-container"){let r=document.getElementById(t);if(!r){r=document.createElement("div"),r.id=t,r.className="mb-4";const o=document.querySelector("form");o.parentNode.insertBefore(r,o)}r.innerHTML=`
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                <strong>Succès:</strong> ${e}
            </div>
        `}static hideMessages(){const e=document.getElementById("error-container"),t=document.getElementById("success-container");e&&(e.innerHTML=""),t&&(t.innerHTML="")}static toggleSubmitButton(e,t="Créer un compte",r="Création en cours..."){const o=document.querySelector('button[type="submit"]');o&&(o.disabled=e,o.textContent=e?r:t,e?o.classList.add("opacity-50","cursor-not-allowed"):o.classList.remove("opacity-50","cursor-not-allowed"))}}class p{static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static isValidPassword(e){return e&&e.length>=8}static passwordsMatch(e,t){return e===t}static validateRegisterForm(e){const t=[];(!e.firstname||e.firstname.trim()==="")&&t.push("Le prénom est obligatoire"),(!e.lastname||e.lastname.trim()==="")&&t.push("Le nom est obligatoire"),(!e.username||e.username.trim()==="")&&t.push("Le nom d'utilisateur est obligatoire"),(!e.email||!this.isValidEmail(e.email))&&t.push("Adresse email invalide"),this.isValidPassword(e.password)||t.push("Le mot de passe doit contenir au moins 8 caractères"),this.passwordsMatch(e.password,e.confirmPassword)||t.push("Les mots de passe ne correspondent pas");const r=document.getElementById("direction");return(!r||!r.value)&&t.push("La direction est obligatoire"),{isValid:t.length===0,errors:t}}}document.addEventListener("DOMContentLoaded",function(){const s=document.querySelector("form");s&&s.addEventListener("submit",h),g()});async function h(s){s.preventDefault(),n.hideMessages();const e={firstname:document.getElementById("prenom").value.trim(),lastname:document.getElementById("nom").value.trim(),username:document.getElementById("username").value.trim(),email:document.getElementById("email").value.trim(),password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value},t=p.validateRegisterForm(e);if(!t.isValid){n.showError(t.errors.join("<br>"));return}const o=document.getElementById("direction").value;if(!o){n.showError("Veuillez sélectionner une direction");return}const d=a.find(i=>i.numero==o),u={firstname:e.firstname,lastname:e.lastname,username:e.username,email:e.email,password:e.password,directionDto:{numero:d.numero,nom:d.nom}};n.toggleSubmitButton(!0);try{const i=await l.register(u);i.success?(l.storeAuthData(i.data),n.showSuccess("Compte créé avec succès ! Redirection..."),setTimeout(()=>{window.location.href="./index.html"},2e3)):n.showError(i.error)}catch(i){n.showError("Une erreur inattendue s'est produite"),console.error("Erreur:",i)}finally{n.toggleSubmitButton(!1)}}
