import{a}from"./config-DuvyDCry.js";class i{static async register(e){try{const t=await fetch(`${a}/api/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de l'inscription");return{success:!0,data:r}}catch(t){return{success:!1,error:t.message}}}static async login(e){try{const t=await fetch(`${a}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la connexion");return{success:!0,data:r}}catch(t){return{success:!1,error:t.message}}}static storeAuthData(e){localStorage.setItem("authToken",e.token),localStorage.setItem("userData",JSON.stringify(e.user))}static getToken(){return localStorage.getItem("authToken")}static isLoggedIn(){const e=this.getToken();return e!==null&&e!==""}static logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userData")}}class n{static showError(e,t="error-container"){let r=document.getElementById(t);if(!r){r=document.createElement("div"),r.id=t,r.className="mb-4";const s=document.querySelector("form");s.parentNode.insertBefore(r,s)}r.innerHTML=`
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <strong>Erreur:</strong> ${e}
            </div>
        `}static showSuccess(e,t="success-container"){let r=document.getElementById(t);if(!r){r=document.createElement("div"),r.id=t,r.className="mb-4";const s=document.querySelector("form");s.parentNode.insertBefore(r,s)}r.innerHTML=`
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                <strong>Succès:</strong> ${e}
            </div>
        `}static hideMessages(){const e=document.getElementById("error-container"),t=document.getElementById("success-container");e&&(e.innerHTML=""),t&&(t.innerHTML="")}static toggleSubmitButton(e,t="Créer un compte",r="Création en cours..."){const s=document.querySelector('button[type="submit"]');s&&(s.disabled=e,s.textContent=e?r:t,e?s.classList.add("opacity-50","cursor-not-allowed"):s.classList.remove("opacity-50","cursor-not-allowed"))}}class c{static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static isValidPassword(e){return e&&e.length>=8}static passwordsMatch(e,t){return e===t}static validateRegisterForm(e){const t=[];return(!e.firstname||e.firstname.trim()==="")&&t.push("Le prénom est obligatoire"),(!e.lastname||e.lastname.trim()==="")&&t.push("Le nom est obligatoire"),(!e.username||e.username.trim()==="")&&t.push("Le nom d'utilisateur est obligatoire"),(!e.email||!this.isValidEmail(e.email))&&t.push("Adresse email invalide"),this.isValidPassword(e.password)||t.push("Le mot de passe doit contenir au moins 8 caractères"),this.passwordsMatch(e.password,e.confirmPassword)||t.push("Les mots de passe ne correspondent pas"),{isValid:t.length===0,errors:t}}}document.addEventListener("DOMContentLoaded",function(){const o=document.querySelector("form");o&&o.addEventListener("submit",u)});async function u(o){o.preventDefault(),n.hideMessages();const e={firstname:document.getElementById("prenom").value.trim(),lastname:document.getElementById("nom").value.trim(),username:document.getElementById("username").value.trim(),email:document.getElementById("email").value.trim(),password:document.getElementById("password").value,confirmPassword:document.getElementById("confirm-password").value},t=c.validateRegisterForm(e);if(!t.isValid){n.showError(t.errors.join("<br>"));return}const r={firstname:e.firstname,lastname:e.lastname,username:e.username,email:e.email,password:e.password};n.toggleSubmitButton(!0);try{const s=await i.register(r);s.success?(i.storeAuthData(s.data),n.showSuccess("Compte créé avec succès ! Redirection..."),setTimeout(()=>{window.location.href="./index.html"},2e3)):n.showError(s.error)}catch(s){n.showError("Une erreur inattendue s'est produite"),console.error("Erreur:",s)}finally{n.toggleSubmitButton(!1)}}
