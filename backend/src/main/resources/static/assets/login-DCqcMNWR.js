var d=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);import{a as l}from"./config-CkEC2-gR.js";var m=d((p,a)=>{class i{static async login(e){try{const t=await fetch(`${l}/api/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await t.json();if(!t.ok)throw new Error(r.message||"Erreur lors de la connexion");return{success:!0,data:r}}catch(t){return{success:!1,error:t.message}}}static async verifyToken(e){try{const t=await fetch(`${l}/api/auth/verify-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:e})}),r=await t.json();return t.ok}catch{return!1}}static storeAuthData(e){localStorage.setItem("authToken",e.token),localStorage.setItem("userData",JSON.stringify(e.user));const t=new Date;t.setHours(t.getHours()+24),localStorage.setItem("tokenExpiration",t.toISOString())}static getToken(){return localStorage.getItem("authToken")}static getUserData(){const e=localStorage.getItem("userData");return e?JSON.parse(e):null}static isLoggedIn(){const e=this.getToken(),t=localStorage.getItem("tokenExpiration");return e?t&&new Date>new Date(t)?(this.logout(),!1):!0:!1}static logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userData"),localStorage.removeItem("tokenExpiration"),window.location.replace("./login.html")}}class s{static showError(e,t="error-container"){let r=document.getElementById(t);if(!r){r=document.createElement("div"),r.id=t,r.className="mb-4";const o=document.querySelector("form");o.parentNode.insertBefore(r,o)}r.innerHTML=`
            <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 relative">
                <span class="block sm:inline">
                    <strong>Erreur:</strong> ${e}
                </span>
                <span class="absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer" onclick="this.parentElement.parentElement.style.display='none'">
                    <svg class="fill-current h-6 w-6 text-red-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                        <title>Close</title>
                        <path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/>
                    </svg>
                </span>
            </div>
        `}static showSuccess(e,t="success-container"){let r=document.getElementById(t);if(!r){r=document.createElement("div"),r.id=t,r.className="mb-4";const o=document.querySelector("form");o.parentNode.insertBefore(r,o)}r.innerHTML=`
            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                <span class="block sm:inline">
                    <strong>Succès:</strong> ${e}
                </span>
            </div>
        `}static hideMessages(){const e=document.getElementById("error-container"),t=document.getElementById("success-container");e&&(e.innerHTML=""),t&&(t.innerHTML="")}static toggleSubmitButton(e,t="Se connecter",r="Connexion en cours..."){const o=document.querySelector('button[type="submit"]');o&&(o.disabled=e,e?(o.innerHTML=`
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    ${r}
                `,o.classList.add("opacity-75","cursor-not-allowed")):(o.textContent=t,o.classList.remove("opacity-75","cursor-not-allowed")))}static animateRedirect(e=1500){const t=document.querySelector(".bg-\\[\\#ffffff\\]");t&&t.classList.add("transform","scale-95","opacity-75","transition-all","duration-300"),setTimeout(()=>{window.AuthGuard?window.AuthGuard.redirectAfterLogin():window.location.href="./index.html"},e)}}class c{static isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validateLoginForm(e){const t=[];return!e.email||e.email.trim()===""?t.push("L'adresse email est obligatoire"):this.isValidEmail(e.email)||t.push("Format d'email invalide"),(!e.password||e.password.trim()==="")&&t.push("Le mot de passe est obligatoire"),{isValid:t.length===0,errors:t}}}document.addEventListener("DOMContentLoaded",function(){if(i.isLoggedIn()){const e=i.getToken();i.verifyToken(e).then(t=>{t?window.AuthGuard?window.AuthGuard.redirectAfterLogin():window.location.href="./index.html":i.logout()});return}const n=document.querySelector("form");if(n){n.addEventListener("submit",u);const e=document.getElementById("email");document.getElementById("password"),e&&(e.addEventListener("blur",function(){this.value&&!c.isValidEmail(this.value)?this.classList.add("border-red-500"):this.classList.remove("border-red-500")}),e.focus())}document.addEventListener("keydown",function(e){if(e.key==="Enter"&&e.ctrlKey){const t=document.querySelector("form");t&&t.dispatchEvent(new Event("submit",{bubbles:!0,cancelable:!0}))}})});async function u(n){n.preventDefault(),s.hideMessages();const e={email:document.getElementById("email").value.trim(),password:document.getElementById("password").value},t=c.validateLoginForm(e);if(!t.isValid){s.showError(t.errors.join("<br>"));return}s.toggleSubmitButton(!0);try{const r=await i.login(e);if(r.success)i.storeAuthData(r.data),s.showSuccess(`Bienvenue, ${r.data.user.firstname} ! Redirection...`),s.animateRedirect();else{s.showError(r.error);const o=document.getElementById("email");o&&(o.focus(),o.select())}}catch(r){s.showError("Une erreur de connexion s'est produite. Vérifiez votre connexion internet."),console.error("Erreur de connexion:",r)}finally{s.toggleSubmitButton(!1)}}typeof a<"u"&&a.exports&&(a.exports={AuthService:i,UIUtils:s,FormValidator:c})});export default m();
