import"./modulepreload-polyfill-B5Qt9EMX.js";const g=new URLSearchParams(window.location.search),c=decodeURIComponent(g.get("congeRef")||""),f=document.getElementById("refConge");f.textContent=c;const E=`http://localhost:8080/agent/byConge?ref=${encodeURIComponent(c)}`,i=document.getElementById("matricule"),y=document.getElementById("nom"),h=document.getElementById("prenom"),C=document.getElementById("fonction"),p=document.getElementById("jours"),r=document.getElementById("startDate"),s=document.getElementById("endDate"),l=document.getElementById("numDays"),v=document.getElementById("addCongeBtn");async function I(){try{const t=await fetch(E);if(!t.ok)throw new Error("Agent non trouvé");const n=await t.json(),e=n.agent,o=n.jours??(e.conges&&e.conges.length>0?e.conges[0].jours:"--");i.textContent=e.matricule,y.textContent=e.nom,h.textContent=e.prenom,C.textContent=e.fonction,p.textContent=o}catch(t){alert(t.message)}}function u(){const t=new Date(r.value),n=new Date(s.value);if(t.toString()!=="Invalid Date"&&n.toString()!=="Invalid Date"&&n>=t){const e=n-t,o=Math.floor(e/(1e3*60*60*24))+1;l.textContent=o}else l.textContent=0}r.addEventListener("change",u);s.addEventListener("change",u);v.addEventListener("click",async()=>{const t=i.textContent.trim(),n=r.value,e=s.value,o=parseInt(l.textContent,10);if(!c)return alert("⚠️ Référence de congé invalide.");if(!t||t==="--")return alert("⚠️ Matricule agent introuvable.");if(!n||!e)return alert("⚠️ Veuillez choisir la période.");if(!o||o<=0)return alert("⚠️ Nombre de jours invalide.");const m={matricule:t,congeRef:c,dateDebut:n,dateFin:e,jours:o};try{const a=await fetch("http://localhost:8080/suivi-conge",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)}),d=await a.json();if(!a.ok)throw d.message?new Error(`❌ ${d.message}`):new Error("❌ Erreur lors de l'ajout du congé");alert(`✅ Congé ajouté avec succès (ID: ${d.id})`),r.value="",s.value="",l.textContent=0}catch(a){alert(a.message)}});I();
